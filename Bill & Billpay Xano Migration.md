
BillPay

Payment creation-related flows. Schedule payment from bill (p-bill-schedulePayment). User clicks "Schedule Payment" on approved bill Validate vendor has active payment_method BWF billpayment_create Create BillPayment (status = Scheduled) Create BillPayment_item (link to expense) Update expense: status = Scheduled, amount_balance_due -= payment amount Schedule BWF billpayment_schedule for payment_date Create payment from BillPay page (pg-billpay > p-billpayment-create) User navigates to pg-billpay Clicks "Create Payment" Select vendor and multiple approved bills BWF billpayment_create Create BillPayment with multiple BillPayment_items Bulk payment creation (pg-bill-list) User selects multiple approved bills Bulk action: "Pay Bills" Groups bills by vendor BWF billpayment_create (for each vendor group) Payment processing-related flows. Scheduled payment processing (BWF billpayment_schedule - runs daily) Query: status = Scheduled AND payment_date = Today Validate: sufficient funds, payment_method active, bills still approved For each payment → BWF billpay_send_ach (if ACH) ACH payment processing (BWF billpay_send_ach) Update BillPayment: status = Processing POST Xano /api:billpay/ach Payload: billpayment_bubble_id, payment_method_bubble_id, amount, memo, company_id Xano → Dwolla API POST /transfers Source: company funding source Destination: vendor funding source Amount, metadata (billpayment_id, memo) Dwolla returns transfer ID, status = pending BWF billpayment_update (Xano webhook callback) Update BillPayment: status = Pending, store Dwolla transfer ID Update expense: status = Pending Payment If failure: status = Failed, call BWF bill_payment_error Dwolla webhook (customer_transfer_completed/failed/cancelled) POST to Xano webhook receiver Xano processes and calls Bubble BWF bill-payment-complete Update BillPayment: status = Completed (or Failed) Update expense: status = Paid, mark_as_paid = true, amount_balance_due = 0 BWF bill_paid (sync to QBO, send notifications) Check payment processing Generate check PDF Mark as Pending Mailing User confirms mailing → status = Mailed Eventually → status = Cleared BWF bill_payment_check_update Payment failure handling (BWF bill_payment_error) Update BillPayment: status = Failed, store error message/code Revert expense: status = Approved, restore amount_balance_due Send notifications (payment creator, AP team) Log error for troubleshooting May trigger automatic retry or flag for manual review Payment management-related flows. View payment details (pg-billpayment-detail / p-billpayment-details) Display payment info (ID, status, amount, date, created by) Show associated bills (BillPayment_item records via table-payment-lines) Display Dwolla transfer ID and transaction timeline Actions: cancel, modify date, view in QBO, download confirmation Modify payment date (p-billpayment-modifyDate) Validate: status must be Scheduled User enters new date (minimum: Today) BWF billpayment_update Update BillPayment: payment_date = new date Reschedule billpayment_schedule workflow Cancel payment (p-billpayment-cancel) Validate: can cancel if Scheduled or early Pending User confirms cancellation If payment initiated with Dwolla: Call Dwolla API to cancel transfer BWF billpayment_update Update BillPayment: status = Cancelled Revert bills: status = Approved, restore amount_balance_due Payment method management-related flows. Add payment method (pg-vendor-payment-methods > p-payment-method) User opens p-payment-method popup from vendor page Select payment type: ACH or Check If ACH: Enter: bank name, routing number, account number, account type Create payment_method record (status = Pending Verification) POST Xano Dwolla Service: Create Funding Source API Connector: Dwolla (Xano) > Create Funding Source Payload: payment_method_bubble_id, routing_number, account_number, account_type, name Xano → Dwolla API POST /funding-sources Dwolla returns funding_source_id Update payment_method: store Dwolla funding_source_id, status = Pending Verification Dwolla sends micro-deposits (2 small amounts, 1-3 business days) If Check: Enter: mailing address, check payable to name Create payment_method record (status = Active) Verify micro-deposits (p-payment-method) Vendor receives 2 small deposits in bank account (1-3 days) User enters two deposit amounts in popup POST Xano Dwolla Service: Micro-deposits verify API Connector: Dwolla (Xano) > Micro-deposits Payload: funding_source_id, amount1, amount2 Dwolla verifies amounts Update payment_method: status = Active Now eligible for payments Remove payment method (m-payment-method) User selects "Remove" from action menu Confirmation popup Call Dwolla API: Remove Funding Source API Connector: Dwolla (Xano) > Remove Funding Source Update payment_method: status = Inactive Payment integration-related flows. Sync to QuickBooks Online (qbo-billpayment-create) Validate: integration connected, bill synced to QBO (has AcctIntID) Map payment account to QBO bank account Prepare QBO BillPayment payload (VendorRef, TxnDate, Line with LinkedTxn to bill, BankAccountRef) POST QBO API /v3/company/<realmId>/billpayment Store QBO BillPayment ID in BillPayment record Mark bills as paid in QBO Bulk payment sync (bill-bulk-sync-integration_billpay_create) Process multiple completed payments Call qbo-billpayment-create for each Track progress, show summary BillPay configuration-related flows. Enable BillPay feature (pg-billpay-marketing > p-billpay-enableBillpayFeature > pg-billpay-settings) User navigates to BillPay, sees pg-billpay-marketing Clicks "Enable BillPay" Popup p-billpay-enableBillpayFeature opens User reviews terms and accepts Update company_setting_bill: BillPay enabled = true May trigger Dwolla customer onboarding Setup company bank account for payments Redirect to pg-billpay-settings Configure default payment account BillPay settings configuration (pg-billpay-settings) Select default bank account for payments Configure payment approval settings (if any) Set notification preferences Store in company_setting_bill Payment account setup (p-billpayment-account) Select from company's linked bank accounts Store as default for payments BillPay data display & other related objects. Primary Display pg-billpay - Main payments listing with filters and search. pg-billpayment-detail - Payment detail page showing full payment info and associated bills. pg-vendor-payment-methods - Vendor payment methods list (ACH, Check, Wire). Payment Management p-billpayment-create - Create new payment popup with vendor/bill selection. p-billpayment-details - Payment detail popup with transaction info. p-billpayment-cancel - Cancel payment confirmation popup. z_p-billpayment-cancel - Legacy cancel payment popup. p-billpayment-modifyDate - Change payment date popup. p-bill-schedulePayment - Schedule payment from bill detail view. Payment Method Management p-payment-method - Add/edit payment method popup (ACH or Check). p-billpayment-account - Select payment account popup. m-payment-method - Payment method action menu. Configuration & Settings pg-billpay-settings - BillPay configuration and defaults. pg-billpay-marketing - BillPay marketing/onboarding page for non-enabled companies. p-billpay-enableBillpayFeature - Enable BillPay feature popup with terms. Secondary Display Components wf-billPayment - Workflow container reusable for payment workflows. w-card-detail-billpayment - Payment summary card for dashboards. drawer-payment-details - Payment details drawer showing transaction timeline. w-billpay-account-type - Bank account type selector (checking/savings). input_payment_account - Payment account input component. input-payment-account - Alternate payment account input component. table-payments - Payment list table. table-payment-lines - Bills included in payment table. f-bill-payments - Payment filter component (status, vendor, date, amount). bdg_status_bill_payment-dep - Payment status badge component (deprecated). bdg_payment_method-dep - Payment method badge component (deprecated).
<!--stackedit_data:
eyJoaXN0b3J5IjpbLTMzNzQ0NjQ3MSwtMjE0NTcxOTA5OSwtMj
A1MzE3NDEyMiwtMTkxNDUwOTU2MSwtMTc2MjA0MjIsLTE3NjIw
NDIyXX0=
-->